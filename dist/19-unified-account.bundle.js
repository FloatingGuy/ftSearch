(window.webpackJsonp=window.webpackJsonp||[]).push([[66],{3253:function(e,t,o){"use strict";o(365)},3604:function(e,t,o){"use strict";var s=o(1),n=o.n(s),m=o(0),i=o(8);function c(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,s)}return o}function r(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?c(Object(o),!0).forEach((function(t){n()(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):c(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var a=function(e){return!e||m.g.isObjectEmpty(e)},p={name:"ServiceComment",components:{},filters:{formatNumUnit:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e<1e4?"".concat(e):"".concat(~~(e/1e3)/10,"万")}},mixins:[m.n],props:{source:{type:Object,default:function(){return{}}},data:{type:Object,default:function(){return{}}},item:{type:Object,default:function(){return{}}},pos:{type:Number,default:0},typePos:{type:Number,default:0}},data:function(){return{asyncComment:null,scoreTimes:0,commentActiveClass:""}},computed:{exposeComment:function(){var e=r(r({},this.source.comment),this.asyncComment);return m.g.isObjectEmpty(e)?null:Object.assign(e,{score_times:this.scoreTimes||e.score_times})},tags:function(){return(this.exposeComment.comment_tags||[]).map((function(e){return"".concat(e.tag,"(").concat(e.comment_cnt||0,")")})).join("、")},isNotEmpty:function(){return this.isCommentNotEmpty(this.exposeComment)},hasCommentJumpInfo:function(){return!!this.exposeComment.jumpInfo},allInvites:function(){var e=this.source,t=e.accountInvite,o=e.invites,s=(t?[t]:[]).concat(o||[]);return s.map((function(e){return{id:e.body_id,type:e.busi_type}}))}},watch:{exposeComment:function(e,t){var o=this;!a(e)&&e.isOwn&&(a(t)||t.id!==e.id)&&(this.commentActiveClass="emphasis",setTimeout((function(){o.commentActiveClass=""}),2e3))}},methods:{isCommentNotEmpty:function(e){return!a(e)&&(+e.score||e.desc||e.comment_tags&&e.comment_tags.length)},onTapComment:function(e,t){this.hasCommentJumpInfo&&(e.stopPropagation(),this.M_go(this.exposeComment),this.M_clickReport({clickZone:5,clickContent:t,reportId:t},this.exposeComment),this.createAsyncTask())},createAsyncTask:function(){var e=this;if(this.allInvites.length){var t=function(){e.getAsyncComment(),i.b.offWebviewResume(t),t=null};i.b.onWebviewResume(t)}},getAsyncComment:function(){var e=this;setTimeout((function(){var t={cgiName:"GetExplicitAppraise",data:{items:[{body_id:e.item.docID,appraise_items:e.allInvites}],search_id:m.b.searchId,src:2,from_scene:3,req_scene:m.b.scene,user_attr:{h5_version:m.b.version}}};m.i.getCommonCgiData(t).then((function(o){if(o.errCode||o.cgiName!==t.cgiName)throw o;var s=(((o.body_comments||[])[0]||{}).serviceComment||{}).comment;e.$set(e,"asyncComment",s),setTimeout((function(){m.a.$emit(m.k.resultExposeAnalysis)}))})).catch((function(e){console.warn("服务评价","异步刷新评价失败",e)}))}),500)},updateScoreTimes:function(){var e=this.asyncComment&&this.asyncComment.score_times||this.source.comment.score_times;e&&(this.scoreTimes=e+1)}}},u=(o(3253),o(4)),f=Object(u.a)(p,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return e.exposeComment&&e.isNotEmpty?o("div",{staticClass:"service-comment"},[o("div",{directives:[{name:"active",rawName:"v-active.stop",value:e.hasCommentJumpInfo,expression:"hasCommentJumpInfo",modifiers:{stop:!0}}],staticClass:"service-comment-wrap"},[+e.exposeComment.score?o("div",{staticClass:"service-comment-score",class:{compact:+e.exposeComment.score_times&&(e.exposeComment.desc||e.tags),"with-desc":e.exposeComment.desc},attrs:{"data-report-id":e.M_itemReportId(e.exposeComment.score_reportId)},on:{click:function(t){return t.stopPropagation(),e.onTapComment(t,e.exposeComment.score_reportId)}}},[o("span",{staticClass:"service-comment-score-num"},[e._v(e._s(e.exposeComment.score)+"分")]),+e.exposeComment.score_times?o("span",{staticClass:"service-comment-score-count"},[e._v("("+e._s(e._f("formatNumUnit")(e.exposeComment.score_times))+e._s(e.exposeComment.score_times_unit||"人")+")")]):e._e(),!e.exposeComment.desc&&e.tags&&e.hasCommentJumpInfo?o("span",[e._v("：")]):e._e(),e.exposeComment.desc||e.tags||!e.hasCommentJumpInfo?e._e():o("ui-arrow",{attrs:{size:14,align:"flex"}})],1):e._e(),e.exposeComment.desc||e.tags?o("ui-clamp",{staticClass:"service-comment-comment",class:e.commentActiveClass,attrs:{autoresize:"",tag:"div","max-lines":1},nativeOn:{click:function(t){return t.stopPropagation(),e.onTapComment(t,e.exposeComment.desc?e.exposeComment.reportId:e.exposeComment.tag_reportId)}}},[e.exposeComment.desc?[o("span",{attrs:{slot:"before"},slot:"before"},[e._v("“")]),o("span",{attrs:{"data-report-id":e.M_itemReportId(e.exposeComment.reportId)}},[e._v(e._s(e.exposeComment.desc))]),o("template",{slot:"after"},[o("span",[e._v("”")]),o("ui-arrow",{attrs:{size:14,align:"inline"}})],1)]:e.tags?[o("span",{attrs:{"data-report-id":e.M_itemReportId(e.exposeComment.tag_reportId)}},[e._v(e._s(e.tags))]),o("ui-arrow",{attrs:{slot:"after",size:14,align:"inline"},slot:"after"})]:e._e()],2):e._e()],1)]):e._e()}),[],!1,null,"44bc41db",null);t.a=f.exports},365:function(e,t,o){}}]);