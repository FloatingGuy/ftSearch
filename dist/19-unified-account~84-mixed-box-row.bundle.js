(window.webpackJsonp=window.webpackJsonp||[]).push([[341,134],{1469:function(e,t,i){"use strict";i.r(t);var n=i(0),o=i(16),s=i(495),r=i(485),c={components:{UiFrontTextEllipsis:i(599).a},mixins:[n.n,s.a,n.l],inject:{reportStayTime:{default:function(){return function(){}}}},props:{data:{type:Object,default:function(){return{}}},item:{type:Object,default:function(){return{}}},pos:{type:Number,default:0},typePos:{type:Number,default:0},role:String,allServiceListInContext:{type:Array,default:function(){return[]}}},computed:{tags:function(){return this.item.recommendTag||this.item.tags||this.item.tag},allowTwoLine:function(){return n.b.fontRatio>1}},methods:{onTapProvider:function(e){if(Object(r.a)(this.item)){e.stopPropagation();var t="$.items[".concat(this.pos-1,"]");this.M_serviceSearchGo(this.item),this.M_clickReport({pos:this.pos,clickZone:t,title:this.item.nickName,expand:this.item.subScene,clickContent:[this.item.nickName,this.item.nickName,this.item.userName].join(";")}),this.M_handleInsert(!1,{serviceIdList:this.allServiceListInContext.map((function(e){return e.id})),serviceTitleList:this.allServiceListInContext.map((function(e){return e.title}))}),Object(o.f)(n.m.detail2.ssProvider)}},onTapService:function(e,t){var i="$.items[".concat(this.pos-1,"].serviceList[").concat(t,"]");this.$emit("tap-service",e,t),this.handleProviderJump(Object.assign({title:e.name,clickInfo:{serviceId:this.M_getJumpServiceId(e),serviceTitle:e.name||"",serviceIdList:this.allServiceListInContext.map((function(e){return e.id})),serviceTitleList:this.allServiceListInContext.map((function(e){return e.title}))}},this.item,e)),"function"==typeof this.reportStayTime&&this.reportStayTime(t,this.M_clickReport({clickZone:i,title:e.name,expand:e.subScene,clickContent:[e.name,this.item.nickName,this.item.userName].join(";")},e)),this.M_handleInsert(!1,{serviceId:this.M_getJumpServiceId(e),serviceTitle:e.name||"",serviceIdList:this.allServiceListInContext.map((function(e){return e.id})),serviceTitleList:this.allServiceListInContext.map((function(e){return e.title}))}),Object(o.f)(n.m.detail2.ssService)}}},a=(i(3039),i(4)),u=Object(a.a)(c,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"active",rawName:"v-active",value:!!(e.item.jumpInfo||e.item.jumpUrl||e.item.userName),expression:"!!(item.jumpInfo || item.jumpUrl || item.userName)"}],staticClass:"sevice-search service-list expose_log_elem",attrs:{"data-id":e.M_exposeId()},on:{click:function(t){return e.onTapProvider(t)}}},[e.item.iconUrl?i("div",{directives:[{name:"image",rawName:"v-image:avatar",value:e.item.iconUrl,expression:"item.iconUrl",arg:"avatar"}],staticClass:"logo"}):e._e(),i("div",{staticClass:"content"},[e.item.nickNameHighlight||e.item.desc?i("div",{staticClass:"content-header",class:{bordered:e.item.bordered}},[i("h3",{staticClass:"ellipsis_1",attrs:{role:"button"},domProps:{innerHTML:e._s(e.xss(e.item.nickNameHighlight))}}),e.item.desc?i("ui-front-text-ellipsis",{staticClass:"sevice-search__desc",attrs:{"aria-hidden":"true",list:e.item.desc.split("#ellipsis#")}}):e._e()],1):e._e(),e.item.serviceList&&e.item.serviceList.length?i("div",{staticClass:"heavy-links service-list"},e._l(e.item.serviceList,(function(t,n){return i("div",{directives:[{name:"active",rawName:"v-active.stop",modifiers:{stop:!0}}],key:n,staticClass:"heavy-link",attrs:{role:"button","data-report-id":e.M_itemReportId(t.reportId,n+1)},on:{click:function(i){return i.stopPropagation(),e.onTapService(t,n)}}},[i("div",{staticClass:"heavy-link__inner"},[i("div",{class:e.allowTwoLine?"ellipsis_2":"ellipsis_1"},[e._v("\n            "+e._s(t.name)+"\n          ")]),t.desc?i("div",{staticClass:"link-desc ellipsis_2",attrs:{"aria-hidden":"true"}},[e._v("\n            "+e._s(t.desc)+"\n          ")]):e._e()])])})),0):e._e()])])}),[],!1,null,"50c18170",null);t.default=u.exports},1555:function(e,t,i){var n=i(213),o=i(212),s=i(87),r=i(214);e.exports=function(e){return n(e)||o(e)||s(e)||r()},e.exports.__esModule=!0,e.exports.default=e.exports},1556:function(e,t,i){"use strict";i(324)},302:function(e,t,i){},3039:function(e,t,i){"use strict";i(332)},324:function(e,t,i){},325:function(e,t,i){},332:function(e,t,i){},3339:function(e,t,i){"use strict";i(325)},3425:function(e,t,i){"use strict";i(938)},3595:function(e,t,i){"use strict";i(939)},3596:function(e,t,i){"use strict";i(940)},3653:function(e,t,i){"use strict";i(942)},485:function(e,t,i){"use strict";function n(e){return!!e.jumpInfo||(!!e.jumpType||!(!e.userName&&!e.jumpUrl))}i.d(t,"a",(function(){return n}))},495:function(e,t,i){"use strict";var n=i(15),o=i(29),s=i(10),r=i(0),c=new s.a({normal:1,service:2,biz:3,weapp:4,link:5,section:6,menu:7,cards:8}),a=new s.a({service:1,biz:2,weapp:3,link:4,section:5,menu:6,cards:7}),u={data:function(){return{clickZone:c,boxType:a}},mixins:[r.n],methods:{handleProviderJump:function(e){var t={},i=this,n=e.action;if(n)if(1===n.providers.length){var o=n.providers[0];t=o,i.M_serviceSearchGo(o),i.clickReport(e)(o)}else t=n,i.$store.commit({type:"updateActionSheet",title:n.title,desc:n.desc,sub:n.sub,tags:n.tags||n.recommendTag,titleTag:n.titleTag,sheets:n.providers,clickCallback:i.clickReport(e),exposeCallback:i.exposeReport(e)});else t=e,i.M_serviceSearchGo(e);return t},getType:function(e){return e.userName&&e.weappUrl?2:e.jumpUrl?3:1},getClickType:function(e){return e.fromActionSheet?2:1},clickReport:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this;return function(i){Object(n.d)(o.a.hospitalRegister,[t.getType(i),i.title,i.userName||i.jumpUrl,+new Date,r.b.searchId,i.pos||1,i.clickType||t.getClickType(i),2,r.b.sessionId,t.item.docID,r.b.query,e.title||""])}},exposeReport:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this;return function(i){var s=i.reduce((function(e,i,n){return e.type.push(t.getType(i)),e.title.push(i.title),e.appid.push(i.userName||i.jumpUrl),e.pos.push(n+1),e}),{type:[],title:[],appid:[],pos:[]});Object(n.d)(o.a.hospitalRegister,[s.type.join("|"),s.title.join("|"),s.appid.join("|"),+new Date,r.b.searchId,s.pos.join("|"),2,1,r.b.sessionId,t.item.docID,r.b.query,e.title||""])}}}};t.a=u},517:function(e,t,i){"use strict";i.r(t);var n=i(1),o=i.n(n),s=i(0),r=i(10),c=i(16),a=i(8),u=i(495),l=i(1469),p=i(3604),h={created:function(){window.reportVueCreated("src/components/general/basic-block/unified-account/compact-menu.vue")},name:"CompactMenu",mixins:[s.n,s.l],props:{data:{type:Object,default:function(){return{}}},item:{type:Object,default:function(){return{}}},pos:{type:Number,default:0},typePos:{type:Number,default:0},list:{type:Array,default:function(){return[]}}}},d=(i(670),i(4)),f=Object(d.a)(h,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"compact-menu"},[i("div",{staticClass:"compact-menu__bd"},e._l(e.list,(function(t,n){return i("div",{directives:[{name:"active",rawName:"v-active.stop",modifiers:{stop:!0}}],key:n,staticClass:"compact-menu__item",attrs:{"data-report-id":e.M_itemReportId(t.reportId,n+1)},on:{click:function(i){i.stopPropagation(),e.$emit("tap",t,n,e.M_getItemPos(t.reportId))}}},[e._v("\n      "+e._s(t.title||t.name)+"\n    ")])})),0)])}),[],!1,null,"ddd37f56",null).exports,m=i(42);function v(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function g(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?v(Object(i),!0).forEach((function(t){o()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):v(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var _={name:"StarScore",model:{prop:"value",event:"input"},props:{readOnly:{type:Boolean,default:!1},value:{type:Number,default:0},labels:{type:Array,default:function(){return[]}},size:{type:Number,default:16},gap:{type:Number,default:2},activeColor:{type:String,default:"var(--YELLOW)"},defaultColor:{type:String,default:"var(--STAR-DEFAULT)"},showScoreNum:{type:Boolean,default:!1},rem:{type:Boolean,default:!1}},data:function(){return{ratio:0,score:0,touchStart:!1,moveCount:0}},computed:{starStyle:function(){for(var e=new Array(5).fill({}),t=1;t<=5;t++){var i=0;i=this.score>=t?1:this.score+1>t?this.score+1-t:0,e[t-1]=g(g({},i>0&&i<1?{backgroundImage:["linear-gradient(to right,","".concat(this.activeColor," 0,"),"".concat(this.activeColor," ").concat(100*i,"%,"),"".concat(this.defaultColor," ").concat(100*i,"%,"),"".concat(this.defaultColor," 100%)")].join("")}:{backgroundColor:i?this.activeColor:this.defaultColor}),{},{width:this.rem?"".concat(this.size/16,"rem"):"".concat(this.size,"px"),height:this.rem?"".concat(this.size/16,"rem"):"".concat(this.size,"px"),marginLeft:t-1?"".concat(this.gap,"px"):0})}return e}},watch:{value:{handler:function(e){this.ratio=100*e/5,this.score=this.value},immediate:!0}},methods:{onTouchStart:function(e){if(!this.readOnly){e.preventDefault(),e.stopPropagation(),this.touchStart=!0;var t=e.currentTarget.getBoundingClientRect(),i=e.touches[0].pageX-t.left,n=t.width;this.handleData(i,n)}},onTouchMove:function(e){this.touchStart&&(e.preventDefault(),e.stopPropagation(),this.moveCount++,this.moveCount>3&&(this.onTouchStart(e),this.moveCount=0))},onTouchEnd:function(e){this.touchStart&&(e.preventDefault(),e.stopPropagation(),this.$emit("change",this.score)),this.touchStart=!1},onClick:function(e){if(!this.readOnly){e.preventDefault(),e.stopPropagation();var t=e.currentTarget.getBoundingClientRect(),i=e.pageX-t.left,n=t.width;this.handleData(i,n),this.$emit("change",this.score)}},handleData:function(e,t){var i=e/t*100,n=Math.max(Math.min(Math.ceil(i/20),5),1);n!==this.score&&(this.score=n,this.$emit("input",n))}}},y=(i(3425),Object(d.a)(_,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"star-score",class:{readOnly:e.readOnly},on:{touchstart:e.onTouchStart,touchmove:e.onTouchMove,touchend:e.onTouchEnd,touchcancel:e.onTouchEnd,click:e.onClick}},e._l(5,(function(t){return i("svg-icon",{key:t,staticClass:"star-score-star",style:e.starStyle[t-1],attrs:{name:"star",render:"mask"}})})),1)}),[],!1,null,"498390ca",null).exports),b=i(669),I=i(2),k={data:function(){return{isTextAreaFocus:!1,isAdjustReady:!1,keyboardHeight:0,lastWindowHeight:window.innerHeight,lastBodyOffset:0,lastTouchPageY:0,resizeTimer:0,focusTimer:0,blurTimer:0,inputReported:!1}},created:function(){Global.os.ios?(s.i.getKeyboardHeight(),a.b.onGetKeyboardHeight(this.getKeyboardHeight)):Global.os.android&&window.addEventListener("resize",this.onWindowResize)},destroyed:function(){Global.os.ios&&a.b.offGetKeyboardHeight(this.getKeyboardHeight),Global.os.android&&window.removeEventListener("resize",this.onWindowResize)},methods:{getKeyboardHeight:function(e){this.keyboardHeight=e.height||this.keyboardHeight,e.height||this.$refs.content.blur()},onWindowResize:function(){var e=this;this.show&&(clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout((function(){var t=window.innerHeight;e.lastWindowHeight>t?e.keyboardHeight=e.lastWindowHeight-t:e.$refs.content.blur()}),10))},onTextAreaFocus:function(e){var t=this;this.isTextAreaFocus=!0,clearTimeout(this.focusTimer),clearTimeout(this.blurTimer),this.focusTimer=setTimeout((function(){t.adjustPosition()}),300)},onTextAreaBlur:function(){var e=this;this.isTextAreaFocus=!1,this.isAdjustReady=!1,clearTimeout(this.focusTimer),clearTimeout(this.blurTimer),this.blurTimer=setTimeout((function(){e.resetPosition(),e.$forceUpdate()}))},onTextareaInput:function(e){Global.os.android&&e.currentTarget&&(this.form.content=e.currentTarget.value),this.inputReported||(this.reportClick(I.g.INPUT),this.inputReported=!0)},onTextareaTouch:function(e){this.lastTouchPageY=e.changedTouches[0].pageY},onTextareaTouchMove:function(e){var t=e.changedTouches[0].pageY-this.lastTouchPageY,i=e.target,n=i.scrollTop,o=i.clientHeight,s=i.scrollHeight;e.cancelable&&t>0&&n<=0&&e.preventDefault(),e.cancelable&&t<0&&n+o>=s&&e.preventDefault()},handleTextareaFocus:function(){this.$refs.placeholder.scrollTo({top:this.$refs.placeholder.scrollHeight,behavior:"smooth"}),this.$refs.content.focus(),this.$refs.content.scrollTo({top:this.$refs.content.scrollHeight}),this.lastBodyOffset<0&&Global.os.ios&&(this.$refs.body.style.transform="translateY(".concat(this.lastBodyOffset,"px)"))},onPlaceholderClick:function(){this.handleTextareaFocus(),this.reportClick(I.g.CLICK_INPUT)},adjustPosition:function(){var e=this,t=this.$el.querySelector(".weui-half-screen-dialog");if(t){var i,n=t.querySelector(".header"),o=t.offsetTop,s=n.offsetHeight;i=window.visualViewport?window.visualViewport.height-o-s-20:window.innerHeight-o-s-this.keyboardHeight-20;var r=function(){var t=e.$refs.content,i=e.$refs.placeholder.getBoundingClientRect();t.style.top="".concat(i.top,"px"),t.style.left="".concat(i.left,"px"),t.style.width="".concat(i.width,"px"),e.isAdjustReady=!0};this.$nextTick((function(){var t=e.$refs.body.scrollHeight;e.lastBodyOffset=i-t,t>i?(e.$refs.body.style.transform="translateY(".concat(e.lastBodyOffset,"px)"),setTimeout(r,400)):r()}))}},resetPosition:function(){this.$el.querySelector(".weui-half-screen-dialog")&&this.$refs.body&&(this.$refs.body.style.transform="translateY(0)")}}};function C(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function S(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?C(Object(i),!0).forEach((function(t){o()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):C(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var w={name:"ServiceCommentHalfScreen",components:{StarScore:y,UiCheckboxGroup:b.a},mixins:[s.n,k],props:{show:{type:Boolean},showSugs:{type:Boolean},allowEmpty:{type:Boolean},score:{type:Number},minLength:{type:Number},postInfo:{type:Object,default:function(){return{}}},params:{type:Object,default:function(){return{}}},reportId:{type:String},data:{type:Object,default:function(){return{}}},item:{type:Object,default:function(){return{}}},pos:{type:Number,default:0},typePos:{type:Number,default:0},pageScrollY:{type:Number,default:0},placeholders:{type:Array,default:function(){return[]}}},data:function(){return{form:{request_id:"",service_id:"",body_id:"",busi_type:"",action_type:0,score:this.score,content:"",tags:[],is_anony:!1,scene:s.b.scene,searchId:s.b.searchId,h5_version:s.b.version},posting:!1,tags:[],tagsType:"",actionType:I.g}},computed:{placeholder:function(){var e=this.form.score-1;return this.placeholders[e]||this.postInfo.post_hint||"分享你的使用经验"},scoreHint:function(){var e=this.form.score-1,t=this.postInfo.score_hint||["很差","较差","还行","好","推荐"];return e>=0&&t[e]||""}},watch:{show:function(e){e&&this.$refs.content&&this.$refs.content.focus()},score:function(e){this.form.score=e,this.onScoreChange(e)},params:{handler:function(e){this.form=S(S(S({},this.form),e),{},{request_id:e.request_id||this.form.request_id||"".concat(Date.now())})},immediate:!0,deep:!0},postInfo:{handler:function(e){!e.tags||e.tag_info&&e.tag_info.posi_tags&&e.tag_info.neg_tags||(this.tags=(e.tags||[]).map((function(e){return{label:e,value:e}}))),this.form.service_id=e.service_id||this.form.service_id,this.form.body_id=e.body_id||this.form.body_id,this.form.busi_type=e.busi_type||this.form.busi_type},immediate:!0,deep:!0}},created:function(){this.M_itemReportId(this.reportId)},methods:{onTapClose:function(){this.$emit("cancel"),this.reportClick(I.g.CLICK_CLOSE_DIALOG,"关闭")},onTapAnnoy:function(){this.reportClick(this.form.is_anony?I.g.CLICK_ADD:I.g.CLICK_REVERT,"匿名")},onTapTags:function(e,t){this.reportClick(t.checked?I.g.CLICK_REVERT:I.g.CLICK_ADD,"TAB_".concat(t.label))},onScoreChange:function(e){var t=this.postInfo.tag_info||{};if(t.medium_score&&t.posi_tags&&t.neg_tags){var i=e>=t.medium_score?"posi_tags":"neg_tags";if(this.tagsType!==i){this.tagsType=i;var n=t[i];this.tags=n.map((function(e){return{label:e,value:e}})),this.form.tags=[]}}},onTagsChange:function(e){this.form.tags=e.filter((function(e){return e.checked})).map((function(e){return e.value}))},onClickSug:function(e,t){var i=this;e.preventDefault(),e.stopPropagation();var n="".concat(this.form.content,"\n").concat(t,"：");this.form.content=n.replace(/^\s+/,""),this.handleTextareaFocus(),setTimeout((function(){i.$refs.placeholder.scrollTo({top:i.$refs.placeholder.scrollHeight})})),this.reportClick(I.g.CLICK_ADD,"SUG_".concat(t))},checkPostEnable:function(){var e=this.form.content.trim(),t=e.length<this.minLength;if(this.allowEmpty&&e&&t||!this.allowEmpty&&t)return s.a.$emit(s.k.showToast,{text:"至少输入".concat(this.minLength,"个字")}),!1;var i=this.form;return!(!(i.request_id&&i.service_id&&i.busi_type&&i.body_id)||!this.allowEmpty&&this.minLength&&!i.content)||(s.a.$emit(s.k.showToast,{text:"参数不完整，请刷新重试"}),this.form,!1)},onPost:function(){var e=this;!this.posting&&this.checkPostEnable()&&(this.posting=!0,this.form,s.i.getCommonCgiData({cgiName:"UpsertAppraise",data:this.form}).then((function(t){if("UpsertAppraise"!==t.cgiName||t.errCode)throw t;e.$emit("success",e.form)})).catch((function(e){console.warn("服务评价","评价提交失败",e),s.a.$emit(s.k.showToast,{text:"发表失败，请稍后重试",action:2})})).finally((function(){e.posting=!1})),this.reportClick(I.g.CONFIRM_CHANGE_CODE,this.form.content?"发表":"发表(无文字)"))},reportClick:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.M_clickReport({actionType:e,reportId:this.reportId,clickContent:t})}}},x=(i(3595),Object(d.a)(w,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("textarea",{directives:[{name:"model",rawName:"v-model",value:e.form.content,expression:"form.content"}],ref:"content",staticClass:"service-content-input",class:e.isAdjustReady&&e.isTextAreaFocus?"focus":"hide",attrs:{placeholder:e.placeholder,maxlength:"200"},domProps:{value:e.form.content},on:{focus:e.onTextAreaFocus,blur:e.onTextAreaBlur,input:[function(t){t.target.composing||e.$set(e.form,"content",t.target.value)},e.onTextareaInput],touchstart:function(t){return t.stopPropagation(),e.onTextareaTouch.apply(null,arguments)},touchmove:function(t){return t.stopPropagation(),e.onTextareaTouchMove.apply(null,arguments)}}}),i("half-screen",{staticClass:"popup",class:{focus:e.isTextAreaFocus},attrs:{show:e.show},on:{cancel:function(t){return e.$emit("cancel")}}},[i("div",{staticClass:"header flex",attrs:{slot:"header"},on:{touchmove:function(e){e.preventDefault()}},slot:"header"},[i("div",{staticClass:"header-close"},[i("ui-icon",{attrs:{name:"close"},nativeOn:{click:function(t){return e.onTapClose.apply(null,arguments)}}})],1),i("div",{staticClass:"header-name"},[e._v(e._s(e.postInfo.name))]),i("ui-button",{attrs:{type:"1",mini:"",disabled:e.posting},nativeOn:{click:function(t){return t.stopPropagation(),e.onPost.apply(null,arguments)},touchmove:function(e){e.preventDefault()}}},[e.posting?i("svg-icon",{attrs:{name:"loading"}}):i("span",[e._v(e._s(e.allowEmpty?"完成":"发表"))])],1)],1),i("div",{ref:"body",staticClass:"body",attrs:{slot:"body"},on:{touchmove:function(e){e.stopPropagation(),e.preventDefault()}},slot:"body"},[e.postInfo.tag_info&&e.postInfo.tag_info.need_star_score?i("div",{staticClass:"service-score flex"},[i("star-score",{attrs:{size:24,gap:8},on:{input:e.onScoreChange,change:function(t){return e.reportClick(e.actionType.CLICK_SCORE)}},model:{value:e.form.score,callback:function(t){e.$set(e.form,"score",t)},expression:"form.score"}}),e.form.score?i("span",{staticClass:"service-score-desc"},[e._v(e._s(e.scoreHint))]):e._e()],1):e._e(),!e.showSugs&&e.tags.length?i("div",{staticClass:"service-tags"},[i("ui-checkbox-group",{attrs:{options:e.tags,"allow-empty":"","prevent-scroll":""},on:{change:e.onTagsChange,click:e.onTapTags}})],1):e._e(),e.showSugs&&e.postInfo.tag_info.comment_sugs?i("div",{staticClass:"service-sug"},[i("p",{staticClass:"service-sug-desc"},[e._v("这些方面感到"+e._s(e.scoreHint)+"：")]),i("div",e._l(e.postInfo.tag_info.comment_sugs,(function(t){return i("ui-button",{key:t,on:{tap:function(i){return e.onClickSug(i,t)}},nativeOn:{touchmove:function(e){e.preventDefault()}}},[e._v(e._s(t))])})),1)]):e._e(),i("div",{staticClass:"service-content"},[i("div",{ref:"placeholder",staticClass:"service-content-input fake",class:{empty:!e.form.content,hide:e.isAdjustReady&&e.isTextAreaFocus},on:{click:function(t){return t.stopPropagation(),e.onPlaceholderClick.apply(null,arguments)},touchstart:function(t){return t.stopPropagation(),e.onTextareaTouch.apply(null,arguments)},touchmove:function(t){return t.stopPropagation(),e.onTextareaTouchMove.apply(null,arguments)}}},[e._v(e._s(e.form.content||e.placeholder))])]),i("label",{staticClass:"service-annoy flex"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.form.is_anony,expression:"form.is_anony"}],staticClass:"weui-check",attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.form.is_anony)?e._i(e.form.is_anony,null)>-1:e.form.is_anony},on:{change:[function(t){var i=e.form.is_anony,n=t.target,o=!!n.checked;if(Array.isArray(i)){var s=e._i(i,null);n.checked?s<0&&e.$set(e.form,"is_anony",i.concat([null])):s>-1&&e.$set(e.form,"is_anony",i.slice(0,s).concat(i.slice(s+1)))}else e.$set(e.form,"is_anony",o)},e.onTapAnnoy]}}),i("i",{class:e.form.is_anony?"weui-icon-success":"weui-icon-circle"}),e._v("\n        匿名\n      ")])])])],1)}),[],!1,null,"421e2326",null).exports),T={data:function(){return{resize_obs:null,isButtonNextLine:!1,starMaxWidth:32}},watch:{exposeInvite:{handler:function(e){var t=this;this.$nextTick((function(){e&&t.$refs.wrap?(t.resize_adjustPosition(),window.addEventListener("resize",t.resize_adjustPosition),t.resize_obs=!0):t.resize_obs&&(window.removeEventListener("resize",t.resize_adjustPosition),t.resize_obs=null)}))},immediate:!0}},destroyed:function(){this.resize_obs&&(window.removeEventListener("resize",this.resize_adjustPosition),this.resize_obs=null)},computed:{starProps:function(){return{size:this.showScoreInput?this.starMaxWidth:24,gap:this.showScoreInput||!this.inputInHalfScreen?4:0,readOnly:!this.showScoreInput&&this.inputInHalfScreen,defaultColor:"var(--SCORE-DEFAULT-COLOR)"}}},methods:{resize_adjustPosition:function(){var e,t=this.$refs.ScoreTitle,i=this.$refs.ScoreDesc;t.style.height="".concat(t.children[0].offsetHeight,"px"),i&&(e=i.querySelector(".fake"),i.style.height="".concat(e.offsetHeight,"px"));var n=this.$refs.wrap.offsetWidth-2*parseFloat(getComputedStyle(this.$refs.wrap).padding),o=14*(s.b.fontRatio||1)*(this.inputInHalfScreen?2:7)+8,r=(n-16)/5;if(r<32&&(this.starMaxWidth=r),this.$refs.InviteBtn){var c,a=this.$refs.InviteBtn.$el.offsetWidth,u=Math.max(120+o,(null===(c=e)||void 0===c?void 0:c.offsetWidth)||0);this.isButtonNextLine=n<u+a}else this.showBtnLikeInput&&(this.isButtonNextLine=!0)}}},O=i(77),P=i.n(O),j=i(34),M=i.n(j),L=i(35),E=i.n(L);function $(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=function(e,t){if(!e)return;if("string"==typeof e)return N(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return N(e,t)}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,r=!0,c=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return r=e.done,e},e:function(e){c=!0,s=e},f:function(){try{r||null==i.return||i.return()}finally{if(c)throw s}}}}function N(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}var D=function(){function e(){M()(this,e),o()(this,"set",new Set)}return E()(e,[{key:"add",value:function(e){this.set.add("".concat(s.b.searchId,"_").concat(e.reportId))}},{key:"has",value:function(e){return this.set.has("".concat(s.b.searchId,"_").concat(e.reportId))}},{key:"exist",value:function(e){var t,i=$(this.set);try{for(i.s();!(t=i.n()).done;){if(0===t.value.indexOf(e))return!0}}catch(n){i.e(n)}finally{i.f()}return!1}}]),e}(),A=function(){function e(){M()(this,e),o()(this,"map",new Map)}return E()(e,[{key:"add",value:function(e,t){this.map.has(e.reportId)||this.map.set(e.reportId,t)}},{key:"get",value:function(e){return this.map.get(e.reportId)}}]),e}(),H=function(){function e(){M()(this,e),o()(this,"value",void 0)}return E()(e,[{key:"add",value:function(e){this.value=e}},{key:"get",value:function(){return this.value}}]),e}(),R=new D,B=new A,U=new H;function z(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function q(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?z(Object(i),!0).forEach((function(t){o()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):z(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var G={name:"ServiceCommentInvite",components:{ServiceCommentHalfScreen:x,StarScore:y,HeightAnimate:m.a},mixins:[s.n,T],props:{source:{type:Object,default:function(){return{}}},data:{type:Object,default:function(){return{}}},item:{type:Object,default:function(){return{}}},pos:{type:Number,default:0},typePos:{type:Number,default:0}},data:function(){return{exposeInvite:null,exposeTimestamp:0,score:0,lastScore:0,content:"",contentSubmitting:!1,scoreModified:!1,scoreSubmitted:!1,showScoreInput:!0,showHalfScreen:!1,inputReported:!1,currentExp:0,showHalfScreenImmediate:!1,inputInHalfScreen:!1,showCommentSugs:!1,placeholderWithScore:!1,shouldLimitMinLength:!0,showBtnLikeInput:!1,currentScrollY:window.scrollY,loadHalfScreen:!1,postInfo:{},postParams:{request_id:"",action_type:0,service_id:"",body_id:"",busi_type:0,scene:s.b.scene,searchId:s.b.searchId,h5_version:s.b.version,stay_before_score:0}}},computed:{scoreDesc:function(){return this.source.score_desc||{}},scoreHint:function(){var e=this.lastScore-1,t=this.postInfo.score_hint||["很差","较差","还行","好","推荐"];if(t[e]){if(this.inputInHalfScreen)return t[e];if(this.scoreModified)return"已改为“".concat(t[e],"”");if(this.scoreSubmitted)return"已提交“".concat(t[e],"”")}return""},placeholders:function(){return this.placeholderWithScore&&this.postInfo.post_hints?this.postInfo.post_hints:this.showBtnLikeInput&&this.postInfo.shading_words?this.postInfo.shading_words:this.shouldLimitMinLength||this.placeholderWithScore?new Array(5).fill(this.postInfo.post_hint||"分享你的使用经验"):new Array(5).fill("分享你的使用经验")},placeholder:function(){var e=this.lastScore-1;return this.placeholders[e]||this.postInfo.post_hint||"分享你的使用经验"}},created:function(){s.a.$on(s.k.TOGGLE_COMMENT_INVITE_EXPOSE,this.handleInviteExpose),s.a.$on(s.k.GOTO,this.closeHalfScreen),s.a.$on(s.k.setQuery,this.closeHalfScreen),a.b.onInputChange(this.closeHalfScreen),this.postInfo.name=this.item.title,this.postInfo.icon_url=this.item.iconUrl},destroyed:function(){s.a.$off(s.k.TOGGLE_COMMENT_INVITE_EXPOSE,this.handleInviteExpose),s.a.$off(s.k.GOTO,this.closeHalfScreen),s.a.$off(s.k.setQuery,this.closeHalfScreen),a.b.offInputChange(this.closeHalfScreen)},methods:{handleInviteExpose:function(e,t){var i=this;if(e&&!s.g.isObjectEmpty(e)){if(this.exposeTimestamp=Date.now(),e.delay){var n=Date.now(),o=function(){Date.now()-n>=e.delay&&i.doInviteExpose(e),a.b.offWebviewResume(o),o=null};a.b.onWebviewResume(o)}else this.doInviteExpose(e);this.checkInvite(e)&&this.requestPostInfo(e)}else this.hideInvite()},doInviteExpose:function(e){var t=this;if(!this.isInviteEqual(this.exposeInvite,e)&&!R.exist(s.b.searchId))if(this.checkInvite(e)){var i=this.getPostInfoReqParams(e);this.postParams=q(q(q({},this.postParams),i),{},{request_id:"",action_type:0}),this.exposeInvite=e,this.getPostInfo(e),this.resetScore(),this.postParams.stay_before_score||(this.postParams.stay_before_score=Date.now()-this.exposeTimestamp),this.$forceUpdate(),this.recordInvitedService(e),setTimeout((function(){s.a.$emit(s.k.exposeAnalysis),t.loadHalfScreen=!0}))}else this.hideInvite()},checkInvite:function(e){var t=this,i=function(i){return t.isInviteEqual(i,e)};return this.source.invites&&this.source.invites.find(i)||i(this.source.accountInvite)},isInviteEqual:function(e,t){return e&&t&&(e===t||e.reportId===t.reportId)},hideInvite:function(){this.exposeInvite=null,this.resetScore(),this.$forceUpdate()},recordInvitedService:function(e){var t={cgiName:"AddUserInvitedService",data:{service_id:e.service_id,search_id:s.b.searchId,query:s.b.query}};s.i.getCommonCgiData(t).then((function(e){if(e.errCode||e.cgiName!==t.cgiName)throw e})).catch((function(e){}))},getPostInfo:function(e){var t=this;B.get(e)?this.postInfo=B.get(e):this.requestPostInfo(e,(function(e){t.postInfo=e})),this.getPostExp()},requestPostInfo:function(e,t){var i=this.getPostInfoReqParams(e);s.i.getCommonCgiData({cgiName:"GetPostAppraiseInfo",data:i}).then((function(i){i.rich_info_json&&i.rich_info_json.post_page_info?(B.add(e,i.rich_info_json.post_page_info),t&&t(i.rich_info_json.post_page_info)):console.warn("服务评价","GetPostAppraiseInfo fail",i)})).catch((function(e){console.warn("服务评价","GetPostAppraiseInfo fail",e)}))},getPostInfoReqParams:function(e){var t=e.service_id,i=e.body_id,n=e.busi_type,o=e.jumpInfo;if(t&&i&&n)return{service_id:t,body_id:i,busi_type:+n,h5_version:s.b.version};if(o){var r=o.weappUrl,c=void 0===r?"":r,a=c.substring(c.indexOf("?")+1,c.length),u=P.a.parse(a);return{service_id:u.service_id,body_id:u.body_id,busi_type:+u.busi_type,h5_version:s.b.version}}return{}},getPostExp:function(){if(void 0===U.get())this.requestPostExp();else{var e=U.get();this.handlePostExp(~~e)}},requestPostExp:function(){var e=this;s.i.getCommonCgiData({cgiName:"GetXexptParamList",data:{key_list:[{key:"mmsearch_comment_ui",hit_report:!0}],searchid:s.b.searchId}}).then((function(t){if(t&&"GetXexptParamList"===t.cgiName&&t.param_list){var i=t.param_list[0].value;U.add(~~i),e.handlePostExp(~~i)}}))},handlePostExp:function(e){this.currentExp=e,this.showHalfScreenImmediate=1===e,this.inputInHalfScreen=2!==e,this.showCommentSugs=3===e,this.placeholderWithScore=4===e||6===e,this.shouldLimitMinLength=5!==e&&6!==e,this.showBtnLikeInput=7===e},resetScore:function(){this.score=0,this.lastScore=0,this.content="",this.showScoreInput=!0,this.scoreSubmitted=!1,this.scoreModified=!1,this.postParams.request_id="",this.postParams.action_type=0,this.postParams.stay_before_score=0,this.loadHalfScreen=!1},onScoreChange:function(){this.handleScoreChange(),this.showHalfScreenImmediate&&(this.showHalfScreen=!0,this.currentScrollY=window.scrollY)},handleScoreChange:s.g.debounce((function(){this.score===this.lastScore?this.showScoreInput=!1:(this.score,this.scoreDesc,this.submitScore()),this.resize_adjustPosition(),this.M_clickReport({actionType:I.g.CLICK_SCORE,reportId:this.scoreDesc.reportId,clickContent:""})})),onTapScore:function(){!this.showScoreInput&&this.inputInHalfScreen&&(this.showScoreInput=!0,this.M_clickReport({actionType:I.g.CLICK_EDIT,reportId:this.exposeInvite.reportId,clickContent:""}))},onTapInvite:function(){this.showHalfScreen=!0,this.currentScrollY=window.scrollY,this.M_clickReport({actionType:I.g.CLICK_SHOW_DIALOG,reportId:this.exposeInvite.reportId,clickContent:this.exposeInvite.button})},onTapClose:function(){this.hideInvite(),this.M_clickReport({actionType:I.g.CLICK_FOLD,reportId:this.scoreDesc.reportId})},closeHalfScreen:function(){this.showHalfScreen=!1,window.scrollTo(0,this.currentScrollY)},onTapInput:function(){this.M_clickReport({actionType:I.g.CLICK_INPUT,clickContent:"",reportId:this.exposeInvite.reportId})},focusInput:function(){this.$refs.ScoreInput.focus()},onInput:function(){this.inputReported||(this.M_clickReport({actionType:I.g.INPUT,clickContent:"",reportId:this.exposeInvite.reportId}),this.inputReported=!0)},submit:function(e,t,i){var n=this.postParams;!!(n.request_id&&n.service_id&&n.busi_type&&n.body_id&&this.score)&&s.i.getCommonCgiData({cgiName:"UpsertAppraise",data:e}).then((function(e){if("UpsertAppraise"!==e.cgiName||e.errCode)throw e;t(e)})).catch((function(e){i(e),s.a.$emit(s.k.showToast,{text:"提交失败",action:2})}))},submitScore:function(){var e=this;this.postParams.request_id?this.postParams.action_type=1:(this.postParams.request_id="".concat(Date.now()),this.postParams.action_type=0);var t=q(q({},this.postParams),{},{score:this.score});this.scoreModified=!(!this.lastScore||this.score===this.lastScore),this.lastScore=this.score,this.submit(t,(function(t){e.postParams.action_type=1,e.scoreSubmitted=!0,R.add(e.exposeInvite),e.showScoreInput=!1;var i=e.$parent.$refs.ServiceComment;i&&i.updateScoreTimes&&i.updateScoreTimes()}),(function(e){console.warn("服务评价","提交预评分失败",e),s.a.$emit(s.k.showToast,{text:"提交失败",action:2})}))},submitContent:function(){var e=this;if(!this.contentSubmitting){this.contentSubmitting=!0;var t=this.postInfo.min_post_word_cnt;if(this.shouldLimitMinLength&&this.content.length<t)s.a.$emit(s.k.showToast,{text:"至少输入".concat(this.postInfo.min_post_word_cnt,"个字")}),this.contentSubmitting=!1,this.focusInput();else{var i=q(q({},this.postParams),{},{content:this.content,score:this.score,tags:[],is_anony:!1});this.submit(i,(function(t){e.onPostSuccess(),e.contentSubmitting=!1}),(function(t){console.warn("服务评价","提交评论失败",t),s.a.$emit(s.k.showToast,{text:"提交失败",action:2}),e.contentSubmitting=!1})),this.M_clickReport({actionType:I.g.CONFIRM_CHANGE_CODE,clickContent:this.content?"发表":"发表(无文字)",reportId:this.exposeInvite.reportId})}}},onPostSuccess:function(){s.a.$emit(s.k.showToast,{text:"已提交",action:0}),this.closeHalfScreen(),R.add(this.exposeInvite),this.hideInvite();var e=this.$parent.$refs.ServiceComment;e&&e.getAsyncComment&&(e.getAsyncComment(),setTimeout((function(){e.$el.scrollIntoView({behavior:"smooth",block:"center"})})))}}},W=(i(3596),Object(d.a)(G,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.exposeInvite?i("div",{directives:[{name:"active",rawName:"v-active.stop",modifiers:{stop:!0}}],staticClass:"comment-invite",on:{click:function(e){e.stopPropagation()}}},[i("height-animate",[i("div",{staticClass:"comment-invite-wrap"},[i("div",{ref:"wrap",staticClass:"comment-invite-score",attrs:{"data-report-id":e.M_itemReportId(e.scoreDesc.reportId)},on:{click:function(t){return t.stopPropagation(),e.onTapScore.apply(null,arguments)}}},[i("div",{ref:"ScoreTitle",staticClass:"comment-invite-score-title",class:{hide:!e.showScoreInput}},[i("div",[e._v(e._s(e.postInfo.score_desc||"本次使用体验怎么样？"))])]),i("div",{ref:"ScoreStar",staticClass:"comment-invite-score-star flex wrap"},[i("star-score",e._b({on:{change:e.onScoreChange},model:{value:e.score,callback:function(t){e.score=t},expression:"score"}},"star-score",e.starProps,!1)),e.score>0?i("div",{staticClass:"comment-invite-score-hint"},[e._v(e._s(e.scoreHint))]):e._e()],1),e.inputInHalfScreen&&!e.showBtnLikeInput?i("div",{ref:"ScoreDesc",staticClass:"comment-invite-score-desc",class:{hide:e.showScoreInput},on:{click:function(e){e.stopPropagation()}}},[i("span",{staticClass:"real"},[e._v(e._s(e.postInfo.desc_after_score||"已评分，分享更多经验"))]),i("span",{staticClass:"fake"},[e._v(e._s(e.postInfo.desc_after_score||"已评分，分享更多经验"))])]):e._e()]),e.inputInHalfScreen?[e.showBtnLikeInput?[e.showScoreInput?e._e():i("div",{directives:[{name:"active",rawName:"v-active.stop",modifiers:{stop:!0}}],staticClass:"comment-invite-btn input active__opacity",attrs:{"data-report-id":e.M_itemReportId(e.exposeInvite.reportId)},on:{click:function(t){return t.stopPropagation(),e.onTapInvite.apply(null,arguments)}}},[e._v("\n            "+e._s(e.placeholder)+"\n          ")])]:[e.showScoreInput?e._e():i("ui-button",{staticClass:"comment-invite-btn expand-hotspot real",class:{next:e.isButtonNextLine,inline:!e.isButtonNextLine},attrs:{"data-report-id":e.M_itemReportId(e.exposeInvite.reportId),type:1,mini:""},nativeOn:{click:function(t){return t.stopPropagation(),e.onTapInvite.apply(null,arguments)}}},[e._v(e._s(e.exposeInvite.button||"写评论"))]),i("ui-button",{ref:"InviteBtn",staticClass:"comment-invite-btn fake",attrs:{type:1,mini:""}},[e._v(e._s(e.exposeInvite.button||"写评论"))])]]:i("form",{staticClass:"comment-invite-input",class:{hide:e.showScoreInput,show:!e.showScoreInput}},[e.showScoreInput?e._e():i("div",{attrs:{"data-report-id":e.M_itemReportId(e.exposeInvite.reportId)}}),i("textarea",{directives:[{name:"model",rawName:"v-model",value:e.content,expression:"content"}],ref:"ScoreInput",staticClass:"input",attrs:{maxlength:"200",placeholder:e.placeholder},domProps:{value:e.content},on:{click:e.onTapInput,input:[function(t){t.target.composing||(e.content=t.target.value)},e.onInput]}}),i("div",{staticStyle:{"text-align":"right"},on:{click:function(t){return t.stopPropagation(),e.focusInput.apply(null,arguments)}}},[i("a",{directives:[{name:"active",rawName:"v-active.stop",modifiers:{stop:!0}}],staticClass:"submit active__opacity",attrs:{role:"button"},on:{click:function(t){return t.stopPropagation(),e.submitContent.apply(null,arguments)}}},[e.contentSubmitting?i("svg-icon",{attrs:{name:"loading"}}):i("span",[e._v("发表")])],1)])])],2)]),e.loadHalfScreen&&e.inputInHalfScreen?i("service-comment-half-screen",e._b({attrs:{show:e.showHalfScreen,"show-sugs":e.showCommentSugs,"allow-empty":e.showHalfScreenImmediate,"min-length":e.shouldLimitMinLength?e.postInfo.min_post_word_cnt:0,"post-info":e.postInfo,placeholders:e.placeholders,params:e.postParams,score:e.score,"report-id":e.exposeInvite.reportId},on:{cancel:e.closeHalfScreen,success:e.onPostSuccess}},"service-comment-half-screen",e.$props,!1)):e._e()],1):e._e()}),[],!1,null,"15397e50",null).exports);function F(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function K(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?F(Object(i),!0).forEach((function(t){o()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):F(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var Y=null,V=new r.a({BIZ:1,WE_APP:262208}),J={name:"UnifiedAccount",components:{ServiceCommentInvite:W,ServiceList:l.default,CompactMenu:f,ServiceComment:p.a,ServiceSearchItem:function(){return Promise.resolve().then(i.bind(null,210))}},mixins:[s.n,s.l,u.a,s.j],provide:function(){return{reportStayTime:this.reportStayTime}},props:{data:{type:Object,default:function(){return{}}},source:{type:Object,default:function(){return{}}},item:{type:Object,default:function(){return{}}},pos:{type:Number,default:0},typePos:{type:Number,default:0},role:String,title:String},data:function(){return{setting:null,isVerticalSearch:s.b.isVerticalSearch,localAccUrl:""}},computed:{isBiz:function(){return this.data.real_type===V.BIZ},isWeApp:function(){return this.data.real_type===V.WE_APP},service:function(){return this.itemInfo.service||this.itemInfo.newService},appendTag:function(){var e;return(null===(e=this.itemInfo.titleTag)||void 0===e?void 0:e.append)||null},serviceList:function(){return this.service&&this.service.serviceList},serviceComment:function(){return this.itemInfo.serviceComment||this.service&&this.service.serviceComment||{}},richInfo:function(){var e=this.service&&this.service.richInfo;return e?K(K({},e),{},{itemStyle:1}):null},hasService:function(){return!(!this.serviceList&&!this.richInfo)},serviceOrMenuList:function(){var e=this,t=[];return(this.serviceList||[]).forEach((function(i){var n=e.M_getJumpServiceId(i),o=i.name||"";n&&o&&t.push({id:n,title:o})})),(this.item.menus||[]).forEach((function(e){e.title&&t.push({id:e.title,title:e.title})})),t},isCompact:function(){return 1===this.itemInfo.style},compactMenus:function(){if(this.isCompact){if(this.serviceList&&this.serviceList.length>0)return this.serviceList.map((function(e){return K({isService:!0},e)}));if(this.itemInfo.menus&&this.itemInfo.menus.length>0)return this.itemInfo.menus}return[]},allowTwoLine:function(){return s.b.fontRatio>1}},watch:{item:function(){this.isVerticalSearch=s.b.isVerticalSearch}},created:function(){var e=this;if(20971520===this.data.real_type&&10034===this.data.subType){var t=s.b.localAccExtParams.find((function(e){return"localAccInfo"===e.key}));if(t){var i=JSON.parse(t.textValue),n=i.headUrl,o=void 0===n?"":n,r=(i.nickName,i.username),c=void 0===r?"":r;this.localAccUrl=c&&c===(this.itemInfo&&this.itemInfo.jumpInfo&&this.itemInfo.jumpInfo.userName)?o:""}}a.b.onInputChange((function(){e.onSettingChanged(null)}))},methods:{onTapAccount:function(){this.handleInviteExpose(this.serviceComment.accountInvite),this.isBiz?this.handleBiz():this.isWeApp?this.handleWeApp():this.handleDefault()},onTapMenu:function(e,t,i){var n="",o="";e.title&&(n=e.title,o=e.title),this.handleInviteExposeByIndex(e,t),this.M_go(K(K({},e),{},{clickInfo:{serviceId:n,serviceTitle:o,serviceIdList:this.serviceOrMenuList.map((function(e){return e.id})),serviceTitleList:this.serviceOrMenuList.map((function(e){return e.title}))}})),this.reportStayTime(t,this.M_clickReport({clickZone:1,clickContent:e.title,expand:n&&"menu_".concat(n)||"",itemPos:i},e))},onTapService:function(e,t){this.handleInviteExposeByIndex(e,t)},handleBiz:function(){var e=K(K({},this.itemInfo.jumpInfo),{},{clickInfo:{serviceIdList:this.serviceOrMenuList.map((function(e){return e.id})),serviceTitleList:this.serviceOrMenuList.map((function(e){return e.title}))}});e.extraParams="search_type=1&docid=".concat(decodeURIComponent(this.itemInfo.docID),"&scene=").concat(s.b.scene),this.M_go(e),Object(c.e)(s.m.detail.result.searchItem1),this.reportStayTime(-1,this.M_clickReport({clickZone:0,clickContent:this.itemInfo.title},this.itemInfo))},handleWeApp:function(){var e,t=+new Date,i=K(K({},this.itemInfo.jumpInfo),{},{clickInfo:{serviceIdList:this.serviceOrMenuList.map((function(e){return e.id})),serviceTitleList:this.serviceOrMenuList.map((function(e){return e.title}))}});this.reportStayTime(-1,this.M_clickReport({noStartSearchItemDetailPage:!0,isOpenWeAppPage:!0,jumpUrl:encodeURIComponent(i.weappUrl),expand2:JSON.stringify({adBuffer:i.adBuffer||"",clickId:t})},this.itemInfo)),this.M_go(K(K({},i),{},{subScene:s.g.genWeAppSubScene({adBuffer:this.itemInfo.adBuffer,clickId:t,type:this.data.type,subType:this.data.subType,assuredBuy:this.itemInfo.source&&this.itemInfo.source.assuredBuy}),scene:s.b.scene,searchId:s.b.searchId,clickExtInfo:this.M_getClickExtInfo(),needRecord:1,gameFlag:null!==(e=this.itemInfo.commerceFlag)&&void 0!==e?e:0})),Object(c.e)(s.m.detail.result.applicationAccount)},handleDefault:function(){this.M_go(K(K({},this.itemInfo.jumpInfo),{},{clickInfo:{serviceIdList:this.serviceOrMenuList.map((function(e){return e.id})),serviceTitleList:this.serviceOrMenuList.map((function(e){return e.title}))}})),this.reportStayTime(-1,this.M_clickReport({clickZone:0,clickContent:this.itemInfo.title},this.itemInfo))},handleInviteExpose:function(e,t){e&&!s.g.isObjectEmpty(e)&&(clearTimeout(Y),Y=setTimeout((function(){s.a.$emit(s.k.TOGGLE_COMMENT_INVITE_EXPOSE,e,t)}),100))},handleInviteExposeByIndex:function(e,t){this.handleInviteExpose(this.serviceComment.invites&&this.serviceComment.invites[t],e)},onSettingChanged:function(e){this.$set(this,"setting",e)},onTapSetting:function(e){this.$refs.richInfo.M_onTapMarkButton(e),this.M_clickReport({clickZone:"$.items[".concat(this.pos-1,"].service.richInfo.setting")},e)},onTapCompactMenu:function(e,t,i){if(e.isService){var n="$.items[".concat(this.pos-1,"].serviceList[").concat(t,"]");this.handleInviteExposeByIndex(t),this.handleProviderJump(Object.assign({title:e.name},Object.assign({},this.item,{jumpInfo:null}),e)),this.reportStayTime(t,this.M_clickReport({clickZone:n,title:e.name,expand:e.subScene,clickContent:[e.name,this.item.nickName,this.item.userName].join(";"),itemPos:i},e)),this.M_handleInsert(!1,{serviceId:this.M_getJumpServiceId(e),serviceTitle:e.name||"",serviceIdList:this.serviceOrMenuList.map((function(e){return e.id})),serviceTitleList:this.serviceOrMenuList.map((function(e){return e.title}))})}else this.onTapMenu(e,t,i)},reportStayTime:function(e,t){var i=this,n=t.clickId,o=Date.now(),r=function(){var t=Date.now(),c=t-o,u="";-1===e&&i.serviceComment.accountInvite?u=i.serviceComment.accountInvite.service_id:i.serviceComment.invites&&i.serviceComment.invites[e]&&(u=i.serviceComment.invites[e].service_id),s.f.result.serviceJumpStayReport(["",i.itemInfo.docID,u||"",o,t,c,s.b.searchId,n,s.b.scene]),a.b.offWebviewResume(r),r=null};a.b.onWebviewResume(r)}}},Z=(i(3653),Object(d.a)(J,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.item.foldHide?e._e():i("div",{directives:[{name:"active",rawName:"v-active.stop",modifiers:{stop:!0}}],key:e.item.vueKey,staticClass:"unified-account active__absolute",class:{"unified-account_not-first-account":!e.isService&&1!==e.pos,"unified-account_more-padding":e.isVerticalSearch,"in-service-block":e.isService,"unified-account--link-title-allow-two-line":e.allowTwoLine,"unified-account--with-menu-or-service":e.serviceOrMenuList.length>0||!!e.richInfo},attrs:{"data-id":e.M_exposeId(),"data-report-id":e.M_itemReportId(e.itemInfo.reportId)},on:{click:function(t){return t.stopPropagation(),e.onTapAccount.apply(null,arguments)}}},[i("div",{staticClass:"account-header"},[e.localAccUrl?i("div",{directives:[{name:"image",rawName:"v-image:raw",value:e.localAccUrl||e.itemInfo.iconUrl||"",expression:"localAccUrl || itemInfo.iconUrl || ''",arg:"raw"}],staticClass:"account-header-icon",attrs:{rel:"preload"}}):i("div",{directives:[{name:"image",rawName:"v-image:avatar",value:e.itemInfo.iconUrl||"",expression:"itemInfo.iconUrl || ''",arg:"avatar"}],staticClass:"account-header-icon"}),i("div",{staticClass:"header-text"},[i("div",{staticClass:"header-detail",attrs:{role:"button"}},[i("div",{staticClass:"header-title-container"},[i("span",{staticClass:"header-title",domProps:{innerHTML:e._s(e.xss(e.itemInfo.title))}}),e.appendTag?i("ui-tags",{attrs:{"aria-hidden":"true",tags:e.appendTag,flex:""}}):e._e()],1),i("span",{staticClass:"ui-aria-hidden"},[e._v("帐号描述:")]),e.itemInfo.desc?i("div",{staticClass:"header-desc",class:{"header-desc-single-line":e.hasService},domProps:{innerHTML:e._s(e.xss(e.itemInfo.desc))}}):e._e(),e.itemInfo.source?i("div",{staticClass:"header-source"},[1===e.itemInfo.source.auth?i("ui-tag",{staticClass:"header-auth-tag",attrs:{"aria-hidden":"true",type:14}}):e._e(),!e.isService||e.isService&&e.itemInfo.source.title?i("span",{staticClass:"header-source-text",domProps:{innerHTML:e._s(e.xss(e.itemInfo.source.title))}}):e._e(),e.itemInfo.source.tag?i("ui-tags",{attrs:{"no-bg":"",tags:e.itemInfo.source.tag,flex:"","aria-hidden":"true"}}):e._e(),e.setting?i("ui-image",{directives:[{name:"active",rawName:"v-active.stop",modifiers:{stop:!0}}],staticClass:"setting-icon",attrs:{url:e.setting.iconUrl,size:20,"data-report-id":e.M_itemReportId(e.setting.reportId)},nativeOn:{click:function(t){return t.stopPropagation(),e.onTapSetting(e.setting)}}}):e._e()],1):e._e()]),e.serviceComment.comment||e.serviceComment.invites||e.serviceComment.accountInvite?i("service-comment",e._b({ref:"ServiceComment",staticClass:"service-comment",attrs:{source:e.serviceComment}},"service-comment",e.$props,!1)):e._e(),e.serviceComment.invites||e.serviceComment.accountInvite?i("service-comment-invite",e._b({staticClass:"service-comment",attrs:{source:e.serviceComment}},"service-comment-invite",e.$props,!1)):e._e(),e.serviceList&&!e.isCompact?i("div",[i("service-list",{attrs:{data:e.data,pos:e.pos,"type-pos":e.typePos,item:{serviceList:e.serviceList,docID:e.item.docID,insertFlag:e.item.insertFlag,title:e.item.title,desc:e.service&&e.service.desc,bordered:e.service&&e.service.bordered},"click-zone-prop":"items["+(e.pos-1)+"].service","all-service-list-in-context":e.serviceOrMenuList},on:{"tap-service":e.onTapService}})],1):e._e(),e.itemInfo.menus&&!e.isCompact?i("ui-column",{staticClass:"unified-account-menus",attrs:{col:2,list:e.itemInfo.menus,fill:""},nativeOn:{mouseover:function(e){e.stopPropagation()}},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.item,o=t.index;return[i("ui-link",{attrs:{title:n.title,desc:n.desc,"icon-url":n.iconUrl,"icon-max-size":"","data-report-id":e.M_itemReportId(n.reportId,o+1)},nativeOn:{click:function(t){return t.stopPropagation(),e.onTapMenu(n,o)}}})]}}],null,!1,3208742438)}):e._e(),e.compactMenus&&e.compactMenus.length>0?i("compact-menu",e._b({staticClass:"unified-account__menus_compact",attrs:{list:e.compactMenus},on:{tap:e.onTapCompactMenu}},"compact-menu",e.$props,!1)):e._e()],1)]),e.richInfo?i("service-search-item",{key:e.data.boxID+e.item.docID+"",ref:"richInfo",attrs:{data:Object.assign({},e.data,{items:[Object.assign({},e.richInfo,{docID:e.item.docID})]}),pos:e.pos,"type-pos":e.typePos,item:Object.assign({},e.richInfo,{docID:e.item.docID,insertFlag:e.item.insertFlag,title:e.item.title}),"click-zone-prop":"items["+(e.pos-1)+"].service.richInfo","inject-service-item-ctx":!0},on:{"setting-changed":e.onSettingChanged}}):e._e()],1)}),[],!1,null,"9ab86450",null));t.default=Z.exports},586:function(e,t,i){"use strict";i(302)},599:function(e,t,i){"use strict";var n={name:"UiFrontTextEllipsis",props:{list:{type:Array,required:!0},index:{type:Number,default:0}}},o=(i(586),i(4)),s=Object(o.a)(n,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"ui-front-text-ellipsis"},e._l(e.list,(function(t,n){return i("span",{directives:[{name:"xss-html",rawName:"v-xss-html",value:t,expression:"word"}],key:t,class:{"ui-primary":e.index===n},attrs:{role:"option"}})})),0)}),[],!1,null,"42ac8289",null).exports;s.install=function(e){e.component(s.name,s)};t.a=s},669:function(e,t,i){"use strict";var n=i(1555),o=i.n(n),s=i(1),r=i.n(s),c={name:"UiCheckbox",model:{prop:"checked",event:"change"},props:{label:String,value:[String,Number],disabled:Boolean,name:String,checked:[Boolean,Number],domProps:{type:Object,default:function(){return{}}},preventScroll:Boolean,readonly:Boolean},methods:{onChange:function(e){this.$emit("change",e.target.checked)},onMove:function(e){this.preventScroll&&(e.preventDefault(),e.stopPropagation())}}},a=(i(1556),i(4)),u=Object(a.a)(c,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("label",e._b({directives:[{name:"active",rawName:"v-active.stop",modifiers:{stop:!0}}],staticClass:"ui-checkbox"},"label",e.domProps,!1),[i("input",{staticClass:"ui-checkbox__input",attrs:{"aria-hidden":"true",type:"checkbox",name:e.name,disabled:e.disabled||e.readonly,readonly:e.readonly},domProps:{value:e.value,checked:!!e.checked},on:{change:e.onChange}}),i("span",{staticClass:"ui-checkbox__label",on:{click:function(t){return e.$emit("click")},touchmove:e.onMove,mousewheel:e.onMove}},[e.$slots.default?e._t("default"):[e._v(e._s(e.label))]],2)])}),[],!1,null,"587fb822",null).exports;function l(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function p(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?l(Object(i),!0).forEach((function(t){r()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}u.install=function(e){e.component(u.name,u)};var h={name:"UiCheckboxGroup",components:{UiCheckbox:u,UiColumn:i(200).a},model:{prop:"options",event:"change"},props:{options:Array,keyMap:Object,title:String,column:Number,name:String,single:Boolean,preventScroll:Boolean,allowEmpty:Boolean,firstAsMutex:Boolean,firstAsAll:Boolean,maxDisplayNum:{type:Number,default:0}},computed:{_keyMap:function(){return p({label:"label",value:"value",disabled:"disabled",checked:"checked",name:"name"},this.keyMap)},_readonly:function(){var e=this;if(!this.allowEmpty){var t=function(t){return t[e._keyMap.checked]&&!t[e._keyMap.disabled]},i=this.options.filter(t);return this.options.map((function(e){return!(!t(e)||1!==i.length)||void 0}))}return[]}},methods:{_getProps:function(e,t){return{name:this.name||t[this._keyMap.name],label:t[this._keyMap.label],value:t[this._keyMap.value],disabled:t[this._keyMap.disabled],readonly:this._readonly[e],preventScroll:this.preventScroll,domProps:t.domProps,allowEmpty:this.allowEmpty}},_updateChecked:function(e){var t=this;this.$emit("change",this.options.map((function(i,n){return p(p({},i),{},r()({},t._keyMap.checked,e(i,n)))})))},onChange:function(e,t){var i=this;if(this.firstAsAll&&!this.single)if(0===e)this._updateChecked((function(){return t}));else{this.$set(this.options[e],this._keyMap.checked,t);var n=o()(this.options),s=(n[0],n.slice(1).every((function(e){return e[i._keyMap.checked]})));this._updateChecked((function(e,t){return 0===t?s:e[i._keyMap.checked]}))}else this.firstAsMutex&&!this.single&&t?0===e?this._updateChecked((function(t,i){return i===e})):this._updateChecked((function(n,o){return 0!==o&&(o===e?t:n[i._keyMap.checked])})):this._updateChecked((function(n,o){return i.single?o===e&&t:o===e?t:n[i._keyMap.checked]}));this.$emit("change-by",e)},onClick:function(e,t){this.$emit("click",e,t)}}},d=(i(3339),Object(a.a)(h,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("fieldset",{staticClass:"ui-checkbox-group"},[e.title?i("legend",{staticClass:"ui-checkbox-group__title"},[e.$slots.title?e._t("title"):[e._v(e._s(e.title))]],2):e._e(),e.column?i("ui-column",{attrs:{list:e.options,col:e.column},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.item,o=t.index;return[i("ui-checkbox",e._b({directives:[{name:"show",rawName:"v-show",value:e.maxDisplayNum<=0||o<e.maxDisplayNum,expression:"maxDisplayNum <= 0 || index < maxDisplayNum"}],on:{click:function(t){return e.onClick(o,n)},change:function(t){return e.onChange(o,t)}},model:{value:n[e._keyMap.checked],callback:function(t){e.$set(n,e._keyMap.checked,t)},expression:"item[_keyMap.checked]"}},"ui-checkbox",e._getProps(o,n),!1),[e._t("option",null,{option:n,index:o})],2)]}}],null,!0)}):i("div",e._l(e.options,(function(t,n){return i("ui-checkbox",e._b({directives:[{name:"show",rawName:"v-show",value:e.maxDisplayNum<=0||n<e.maxDisplayNum,expression:"maxDisplayNum <= 0 || index < maxDisplayNum"}],key:t[e._keyMap.value],on:{click:function(i){return e.onClick(n,t)},change:function(t){return e.onChange(n,t)}},model:{value:t[e._keyMap.checked],callback:function(i){e.$set(t,e._keyMap.checked,i)},expression:"item[_keyMap.checked]"}},"ui-checkbox",e._getProps(n,t),!1),[e._t("option",null,{option:t,index:n})],2)})),1)],1)}),[],!1,null,"09fd185c",null).exports);d.install=function(e){e.component(d.name,d)};t.a=d},670:function(e,t,i){"use strict";i(936)},936:function(e,t,i){},938:function(e,t,i){},939:function(e,t,i){},940:function(e,t,i){},942:function(e,t,i){}}]);